version: 0.1
type: update
id: ragbackup-ui-addon
name: Hosteur Backup Dashboard (Beta)

categories:
- apps/dev-and-admin-tools

homepage: https://github.com/hosteur-sa-ch/rag-hosteur-backup-fileagent
baseUrl: https://raw.githubusercontent.com/hosteur-sa-ch/rag-hosteur-backup-fileagent/main
logo: images/logo-hosteur_ico_2021.png

description:
  text: https://raw.githubusercontent.com/hosteur-sa-ch/rag-hosteur-backup-fileagent/main/text/description_ui.md
  short: Create files backup on S3 Hosteur Bucket for your environments.\r\n Go to https://www.hosteur.com/business/stockage/bucket to create S3 your account.


success:
  text: /text/dashboard-credentials.md
  email: /text/dashboard-credentials.md

globals:
  UI_USER: "uiadmin"
  UI_PASS: "${fn.password(12)}"
  BK_KEY: ${fn.password(20)}


settings:
  fields:
    - type: string
      name: s3ak
      caption: Hosteur S3 Account Key
      placeholder: Your Hosteur S3 AK
      required: true
    - type: string
      inputType: password
      name: s3sk
      caption: Hosteur S3 Secret Key
      placeholder: Your Hosteur S3 SK
      required: true
       

onInstall:
  - addui
  - groupDisplayName
  - addfav

actions:
  addui:
    addNodes:
    - nodeGroup: hosteur-rag-backup-ui
      dockerName: hosteurdkuser/hosteur-rag-backup
      fixedCloudlets: 1
      flexibleCloudlets: 4
      skipNodeEmails: true
      dockerEnvVars:
        RESTICUI_USERNAME: ${globals.UI_USER}
        RESTICUI_PASSWORD: ${globals.UI_PASS}
        AWS_ACCESS_KEY_ID: ${settings.s3ak}
        AWS_SECRET_ACCESS_KEY: ${settings.s3sk}
        RESTIC_PASSWORD: ${globals.BK_KEY}
        RESTICUI_RESTORE_FOLDER: /backup-restore
      dockerVolumes:
        - "/backup-restore"

  groupDisplayName:
    api:
      method: environment.control.setnodegroupdisplayname
      params:
          envName : ${env.name}
          nodeGroup: hosteur-rag-backup-ui
          displayName : "Hosteur Backup Dashboard"
  
  addfav:
    api:
      method: environment.file.addfavorite
      params:
          envName : ${env.name}
          nodeGroup: hosteur-rag-backup-ui
          path : "/backup-restore"